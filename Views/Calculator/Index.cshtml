@model InputModel
@{
    ViewData["Title"] = "Currency Conversion Comparison Tool";
}

<div class="min-h-screen bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Currency Conversion Comparison Tool</h1>
            <p class="text-gray-600 mt-2">Compare bank conversion costs with ClearShift and see your potential savings
            </p>
        </div>

        <!-- Main Content -->
        <div class="card mb-8">
            <div class="card-header">
                <h2 class="card-title">Input Method Selection</h2>
            </div>
            <div class="card-content">
                <ul class="nav nav-tabs" id="inputTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="upload-tab" data-bs-toggle="tab" href="#upload" role="tab">
                            <i class="bi bi-upload"></i> Upload Bank File
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="manual-tab" data-bs-toggle="tab" href="#manual" role="tab">
                            <i class="bi bi-pencil"></i> Manual Input
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="custom-tab" data-bs-toggle="tab" href="#custom" role="tab">
                            <i class="bi bi-file-text"></i> Custom Text File
                        </a>
                    </li>
                </ul>

                <div class="tab-content mt-4" id="inputTabContent">
                    <div class="tab-pane fade show active" id="upload" role="tabpanel">
                        <div class="text-center p-12 border-2 border-dashed rounded-lg">
                            <i class="bi bi-upload fs-1 text-gray-400"></i>
                            <p class="mt-2 text-sm text-gray-600">Drag and drop your bank file here, or click to browse
                            </p>
                            <button class="btn btn-primary mt-4">Select File</button>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="manual" role="tabpanel">
                        <form id="manualInputForm" class="grid grid-cols-2 gap-4">
                            <div class="manual-input-form__row">
                                <label class="manual-input-form__label" for="Date">Date:</label>
                                <input type="date" asp-for="Date" id="Date" class="manual-input-form__input" required />
                            </div>

                            <div class="manual-input-form__row">
                                <label class="manual-input-form__label" for="Amount">Amount:</label>
                                <input type="number" asp-for="Amount" id="Amount" class="manual-input-form__input"
                                    required />
                            </div>

                            <div class="manual-input-form__row">
                                <label class="manual-input-form__label" for="SourceCurrency">Source Currency:</label>
                                <select asp-for="SourceCurrency"
                                    asp-items="@(new SelectList(CLSF_Compare.Models.CurrencyConstants.AllowedCurrencies))"
                                    id="SourceCurrency" class="manual-input-form__select">
                                    <option value=""></option>
                                </select>
                            </div>

                            <div class="manual-input-form__row">
                                <label class="manual-input-form__label" for="TargetCurrency">Target Currency:</label>
                                <select asp-for="TargetCurrency"
                                    asp-items="@(new SelectList(CLSF_Compare.Models.CurrencyConstants.AllowedCurrencies))"
                                    id="TargetCurrency" class="manual-input-form__select">
                                    <option value=""></option>
                                </select>
                            </div>

                            <div class="manual-input-form__row">
                                <label class="manual-input-form__label" for="BankRate">Bank Rate:</label>
                                <input type="number" asp-for="BankRate" id="BankRate" class="manual-input-form__input"
                                    required step="0.0001" />
                            </div>

                            <div class="manual-input-form__row">
                                <label class="manual-input-form__label" for="BankFees">Bank Fees:</label>
                                <input type="number" asp-for="BankFees" id="BankFees" class="manual-input-form__input"
                                    step="0.01" />
                            </div>
                        </form>
                        <button type="submit" form="manualInputForm" class="btn btn-primary">Calculate</button>
                    </div>

                    <div class="tab-pane fade" id="custom" role="tabpanel">
                        <div class="text-center p-12 border-2 border-dashed rounded-lg">
                            <i class="bi bi-file-text fs-1 text-gray-400"></i>
                            <p class="mt-2 text-sm text-gray-600">Upload your custom text file with conversion details
                            </p>
                            <button class="btn btn-primary mt-4">Upload Text File</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="grid grid-cols-3 gap-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">with the Bank you get</h3>
                </div>
                <div class="card-body">
                    <p class="text-3xl font-bold text-gray-900" id="bankCost">---</p>
                    <p class="text-sm text-gray-600 mt-2">Including all fees and margins</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">with ClearShift you get</h3>
                </div>
                <div class="card-body">
                    <p class="text-3xl font-bold text-green-600" id="clearshiftCost">---</p>
                    <p class="text-sm text-gray-600 mt-2">Transparent pricing</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Your Savings</h3>
                </div>
                <div class="card-body">
                    <p class="text-3xl font-bold text-blue-600" id="savings">---</p>
                    <p class="text-sm text-gray-600 mt-2">Total potential savings</p>
                </div>
            </div>
        </div>

        <!-- Export Options -->
        <div class="d-flex justify-content-end gap-3 mt-4">
            <button class="btn btn-outline-primary">
                <i class="bi bi-download"></i> Export to Text File
            </button>
            <button class="btn btn-primary">
                <i class="bi bi-file-earmark"></i> Download PDF Report
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#manualInputForm').on('submit', function (e) {
                e.preventDefault();

                $.ajax({
                    url: '@Url.Action("Calculate", "Calculator")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (result) {
                        if (result.error) {
                            alert(result.error);
                            return;
                        }

                        $('#bankCost').text(result.bankConvertedAmount.toLocaleString());
                        $('#clearshiftCost').text(result.clearShiftConvertedAmount.toLocaleString());
                        $('#savings').text(result.savings.toLocaleString());
                    },
                    error: function () {
                        alert('An error occurred while calculating the conversion.');
                    }
                });
            });
        });
    </script>
}